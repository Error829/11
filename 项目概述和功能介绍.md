# 空间站环境监控系统

## 1. 项目概述

本项目是一个用于空间站的环境监控系统,通过多种传感器实时监测空间站内部环境参数,并提供报警和数据管理功能。

## 2. 系统功能

### 2.1 环境监测
- 温度监测: 使用DHT11传感器,实时监测环境温度
- 湿度监测: 使用DHT11传感器,实时监测环境湿度
- 烟雾监测: 使用MQ2传感器,监测空气中的烟雾浓度
- 光照监测: 使用BH1750传感器,监测环境光照强度

### 2.2 报警管理
- 多级报警: 支持信息、警告、严重三个报警级别
- 可配置规则: 支持设置各类环境参数的报警阈值
- 报警提示: LED指示灯和蜂鸣器提示
- 报警记录: 保存历史报警记录

### 2.3 数据管理
- 实时数据采集: 定时采集各传感器数据
- 数据缓存: 为每种传感器维护独立的数据缓存
- 数据查询: 支持查询最新数据和历史数据

## 3. 系统架构

### 3.1 分层设计
1. 驱动层(drivers)
   - sensor: 传感器驱动(DHT11/MQ2/BH1750)
   - output: 输出设备驱动(LED/蜂鸣器)
   - display: 显示设备驱动

2. 数据层(data)
   - 数据采集模块
   - 数据缓存管理
   - 数据处理

3. 业务层(business)
   - 报警管理
   - 规则处理
   - 事件处理

4. 服务层(services)
   - 系统服务
   - 通信服务

### 3.2 核心模块

#### 3.2.1 数据采集模块
- 功能: 负责从各传感器采集数据并进行管理
- 特点:
  * 支持多种传感器
  * 可配置采集周期
  * 数据缓存机制
  * 事件通知机制

#### 3.2.2 报警管理模块
- 功能: 负责报警规则管理和报警触发
- 特点:
  * 多种报警类型
  * 可配置报警规则
  * 多级别报警
  * 报警记录管理

#### 3.2.3 驱动模块
- 功能: 提供硬件设备的统一操作接口
- 特点:
  * 统一的驱动接口
  * 精确的时序控制
  * 完善的错误处理
  * 状态管理

## 4. 实现细节

### 4.1 数据采集实现
1. 采集流程
   - 定时器触发采集
   - 调用传感器驱动读取数据
   - 数据缓存更新
   - 触发回调通知

2. 数据缓存
   - 循环缓冲区实现
   - 独立的传感器数据缓存
   - 支持配置缓存大小

### 4.2 报警处理实现
1. 报警检测
   - 定期检查传感器数据
   - 阈值判断
   - 延时处理
   - 报警触发

2. 报警动作
   - LED状态指示
     * 绿色: 信息
     * 蓝色: 警告
     * 红色: 严重
   - 蜂鸣器提示
   - 报警记录保存
   - 回调通知

### 4.3 驱动实现
1. 传感器驱动
   - DHT11
     * GPIO时序控制
     * 数据校验
     * 温湿度解析
   - MQ2
     * ADC采样
     * 烟雾浓度计算
   - BH1750
     * I2C通信
     * 光照强度计算

2. 输出设备驱动
   - LED控制
     * 颜色设置
     * 闪烁控制
   - 蜂鸣器控制
     * 频率控制
     * 持续时间控制

## 5. 运行流程

1. 系统初始化
   - 驱动初始化
   - 数据采集模块初始化
   - 报警模块初始化
   - 默认规则配置

2. 正常运行
   - 定时采集数据
   - 数据缓存更新
   - 报警检查
   - 状态指示

3. 报警处理
   - 报警条件检测
   - 报警动作执行
   - 报警记录保存
   - 事件通知

## 6. 错误处理

1. 传感器错误
   - 通信超时处理
   - 数据校验错误处理
   - 传感器故障检测

2. 系统错误
   - 内存分配错误处理
   - 定时器错误处理
   - 状态异常处理

## 7. 总结

该项目实现了一个功能完整、架构清晰的空间站环境监控系统。通过分层设计和模块化实现,系统具有良好的可维护性和扩展性。系统的核心功能包括环境监测、报警管理和数据管理,能够有效保障空间站内部环境的安全。
